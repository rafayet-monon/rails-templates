#!/usr/bin/env ruby

# For building production docker image
#
# It sets the envs inside the docker image for precompiling the assets
# Because to precompile the assets, Rails initializes the app.
# And it requires the envs as we always use `ENV.fetch` to setup the variables
#
# Related issue: https://github.com/rails/rails/issues/32947

require 'yaml'

rails_env = ENV.fetch('RAILS_ENV', 'production')
env_config = YAML.load_file('config/application.yml')[rails_env]

if rails_env == 'production'
  env_config.keys.each { |name| ENV[name] = 'dummy_value' }
else
  env_config.each { |name, value| ENV[name] = value }
end

exit system('bin/rails i18n:js:export && bin/rails assets:precompile')
